import{p as e}from"./vendor.6400bf0f.js";var t=[{stage:1,money:300,live:8,mapData:{matrix:[[0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0],[0,0,0,0,0,1,1,1,1,1,1,1,1,0,0,0],[0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0]],start:[0,3],end:[9,10]}},{stage:1,money:100,live:10,mapData:{matrix:[[0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0],[0,0,0,1,1,1,1,1,1,1,0,0,0,0,0,0],[0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0],[0,0,0,0,0,1,1,1,1,0,0,0,1,0,0,0],[0,0,0,0,0,1,0,0,1,0,0,0,1,0,0,0],[0,0,0,0,0,1,0,0,1,1,1,1,1,0,0,0],[0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0]],start:[9,0],end:[5,9]}},{stage:1,money:100,live:10,mapData:{matrix:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,1,1,1,1,1,1,1,0,0],[0,0,1,1,1,0,0,0,0,0,0,0,0,1,0,0],[0,0,1,0,1,0,0,0,0,1,1,1,1,1,0,0],[0,0,1,0,1,0,0,0,0,1,0,0,0,0,0,0],[0,0,1,0,1,1,1,1,1,1,0,0,0,0,0,0],[0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0]],start:[1,0],end:[2,9]}}];class a extends e.exports.Scene{create(){const{width:e,height:a}=this.game.config;this.add.rectangle(e/2,a/2,e,a,4079166),this.add.text(e/2,a/2-100,"塔防遊戲",{fontFamily:'"Noto Sans TC", sans-serif',fontSize:"72px"}).setOrigin(.5),this.add.container(e/2,a/2,[this.add.rectangle(0,0,100,50,2105376).setInteractive({useHandCursor:!0}).on("pointerup",(()=>{this.scene.start("stageScene",t[0])})),this.add.text(0,0,"開始").setOrigin(.5)])}}class i{create(e,t,a){this.scene=e,this.statusBar=this._createStatusBar(),this.tanksBar=this._createTanksBar(a),this.placingLayer=this._createPlacingLayer(t)}_createStatusBar(){const e=document.createElement("div"),t=document.createElement("div"),a=document.createElement("div"),i=document.createElement("div"),n=document.createElement("div");return e.id="status-bar-container",e.style.width="100%",e.style.height="64px",t.id="status-bar",e.appendChild(t),t.appendChild(a),t.appendChild(i),t.appendChild(n),this.scene.add.dom(0,0,e).setOrigin(0),{updateStageText(e){a.innerText=`第 ${e} 關`},updateMoneyText(e){i.innerText=`$: ${e}`},updateLiveText(e){n.innerText=`❤: ${e}`}}}_createTanksBar(e){const t=this._createTankIntro(),a=[],i=[];for(let n=0;n<12;n++){const s=40+80*n,r=this.scene.add.container(s,16,[this.scene.add.rectangle(0,0,64,64,4342338).setOrigin(0),...n<e.length?[this.scene.add.image(0,0,e[n].imageKey).setInteractive({useHandCursor:!0}).on("pointerover",(()=>{t.updateTankIntroText(e[n]),t.setVisible(!0)})).on("pointerout",(()=>{t.setVisible(!1)})).on("pointermove",(e=>{t.updateTankIntroPosition(e)})).on("pointerup",(()=>{a.forEach((t=>{t(e[n])}))})).setOrigin(0)]:[]]);i.push(r)}return this.scene.add.container(0,704,[this.scene.add.rectangle(0,0,1024,96,5921370).setOrigin(0),...i]),{onTankClick(e){a.push(e)}}}_createTankIntro(){const e=document.createElement("div"),t=document.createElement("div"),a=document.createElement("div");e.id="tank-intro-container",t.id="tank-intro-bg",e.appendChild(t),a.id="tank-intro-content",t.appendChild(a);const i=this.scene.add.dom(0,0,e).setOrigin(0,1);return i.setVisible(!1),{setVisible(e){i.setVisible(e)},updateTankIntroText(e){a.innerHTML=`${e.name}<br>射擊速度：<br>攻擊力：<br>特殊功能：緩速<br>價錢：${e.price}`},updateTankIntroPosition({x:e,y:t}){i.setPosition(e,t)}}}_createPlacingLayer(e){const t=[],a=this.scene.add.container(0,64),i=e.matrix.map(((e,a)=>e.map(((e,i)=>this.scene.add.rectangle(64*i,64*a,64,64).setInteractive({useHandCursor:!0}).on("pointerup",(()=>{t.forEach((e=>{e({rowIndex:a,columnIndex:i})}))})).setOrigin(0).setSize(60).setStrokeStyle(4).setDisplayOrigin(-2,-2)))));a.add(i.flat()),a.setVisible(!1);const n=this._createPreviewTank();return{setVisible(e){a.setVisible(e),n.setVisible(e)},updatePreviewTank:n.updatePreviewTank,updatePlacingGridMap(e){i.forEach(((t,a)=>{t.forEach(((t,i)=>{const n=e[a][i]?3135122:16723513;t.setStrokeStyle(4,n)}))}))},onPlacingGridClick(e){t.push(e)}}}_createPreviewTank(){const e=this.scene.add.container(0,0),t=this.scene.add.ellipse(0,0,0,0,15568017,.3),a=this.scene.add.image(0,0);return e.add([t,a]),e.setVisible(!1),this.scene.input.on("pointermove",(({x:t,y:a})=>{e.setPosition(t,a)})),{setVisible(t){e.setVisible(t)},updatePreviewTank(e){a.setTexture(e.imageKey),t.setSize(.5*e.range*64,.5*e.range*64).setOrigin(.5)}}}}class n{create(e,t){this.scene=e,this.placingMatrix=t.matrix.map(((e,t)=>e.map(((e,t)=>0===e)))),this.tanks=this.scene.add.group(),this.mainContainer=this.scene.add.container(0,64),this._createBackground(t)}_createBackground(e){const t=this.scene.add.container(0,0),a=e.matrix.map(((e,t)=>e.map(((e,a)=>{const i={0:10013806,1:15913593};return this.scene.add.rectangle(64*a,64*t,64,64,i[e]).setOrigin(0)}))));t.add(a.flat()),this.mainContainer.add(t)}addTank(e,t,a){const i=64*a,n=64*t,s=this.scene.add.image(i,n,e.imageKey).setOrigin(0);this.mainContainer.add(s),this.tanks.add(s),this.placingMatrix[t][a]=!1}canPlaceAt(e,t){return this.placingMatrix[e][t]}}var s=[{name:"一級砲台",image:"/final/assets/tank_1.ca2959c3.png",imageKey:"tank-brown",range:6,price:50},{name:"二級砲台",image:"/final/assets/tank_2.181a4c2d.png",imageKey:"tank-red",range:8,price:100},{name:"三級砲台",image:"/final/assets/tank_3.af59195d.png",imageKey:"tank-blue",range:10,price:150}];class r extends e.exports.Scene{preload(){s.forEach((e=>{this.load.image(e.imageKey,e.image)}))}create(e){this._stage=0,this._money=0,this._live=0,this._previewTankData=null,this.stageMap=new n,this.ui=new i,this.stageMap.create(this,e.mapData),this.ui.create(this,e.mapData,s),this.stage=e.stage,this.money=e.money,this.live=e.live;this.ui.tanksBar.onTankClick((e=>{if(this.previewTankData===e)return this.ui.placingLayer.setVisible(!1),void(this.previewTankData=null);this.money<e.price||(this.previewTankData=e,this.ui.placingLayer.updatePlacingGridMap(this.stageMap.placingMatrix),this.ui.placingLayer.setVisible(!0))}));this.ui.placingLayer.onPlacingGridClick((({rowIndex:e,columnIndex:t})=>{this.stageMap.canPlaceAt(e,t)&&(this.money-=this.previewTankData.price,this.stageMap.addTank(this.previewTankData,e,t),this.ui.placingLayer.setVisible(!1),this.previewTankData=null)}))}get stage(){return this._stage}set stage(e){this._stage=e,this.ui.statusBar.updateStageText(this._stage)}get money(){return this._money}set money(e){this._money=e,this.ui.statusBar.updateMoneyText(this._money)}get live(){return this._live}set live(e){this._live=e,this.ui.statusBar.updateLiveText(this._live)}get previewTankData(){return this._previewTankData}set previewTankData(e){this._previewTankData=e,null!==e&&this.ui.placingLayer.updatePreviewTank(this._previewTankData)}}!function(){const t={parent:"game",dom:{createContainer:!0},type:e.exports.AUTO,width:1024,height:800,physics:{default:"arcade",arcade:{debug:!1}}},i=new e.exports.Game(t);i.scene.add("welcomeScene",new a),i.scene.add("stageScene",new r),i.scene.start("welcomeScene")}();
