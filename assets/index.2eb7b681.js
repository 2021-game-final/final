import{p as t}from"./vendor.6400bf0f.js";var a={map:[[0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0],[0,0,0,0,0,1,1,1,1,1,1,1,1,0,0,0],[0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0]],start:[0,3],end:[9,10]};class e extends t.exports.Scene{create(){const{width:t,height:e}=this.game.config;this.add.rectangle(t/2,e/2,t,e,4079166),this.add.text(t/2,e/2-100,"塔防遊戲",{fontFamily:'"Noto Sans TC", sans-serif',fontSize:"72px"}).setOrigin(.5),this.add.container(t/2,e/2,[this.add.rectangle(0,0,100,50,2105376).setInteractive({useHandCursor:!0}).on("pointerup",(()=>{this.scene.start("stageScene",a)})),this.add.text(0,0,"開始").setOrigin(.5)])}}const i=[{mapObjId:0,name:"一級砲台",image:"/final/assets/tank_1.ca2959c3.png",imageKey:"tank-brown",range:6,price:50},{mapObjId:1,name:"二級砲台",image:"/final/assets/tank_2.181a4c2d.png",imageKey:"tank-red",range:8,price:100},{mapObjId:2,name:"三級砲台",image:"/final/assets/tank_3.af59195d.png",imageKey:"tank-blue",range:10,price:150}];class n extends t.exports.Scene{preload(){i.forEach((t=>{this.load.image(t.imageKey,t.image)}))}create({map:t}){this.isPlacingMode=!1,this.createMapBgLayer(t),this.createMapBuildingLayer(t),this.createMapPlacingLayer(t),this.createStatusBar(),this.createTankBar(),this.createPreviewTank()}update(){this.updateMapBuildingLayer(),this.updateMapPlacingLayer(),this.updateStatusBar(),this.updateTankBar(),this.updatePreviewTank()}createMapLayer(t){const a=JSON.parse(JSON.stringify(t)),e={mapData:a,container:this.add.container(0,0),gridMap:a.map(((t,a)=>t.map(((t,e)=>this.add.rectangle(64*e,64*a+64,64,64).setOrigin(0)))))};return e.container.add(e.gridMap.flat()),e}createMapBgLayer(t){const a=this.createMapLayer(t);a.mapData.forEach(((t,e)=>{t.forEach(((t,i)=>{const n=0===t?10013806:15913593;a.gridMap[e][i].setFillStyle(n)}))})),this.bgLayer=a}createMapBuildingLayer(t){const a=this.createMapLayer(t);a.mapData=a.mapData.map((t=>t.map((()=>-1)))),this.buildingLayer=a}updateMapBuildingLayer(){}createMapPlacingLayer(t){const a=this.createMapLayer(t);a.container.setVisible(!1),a.gridMap.forEach(((t,a)=>{t.forEach(((t,e)=>{t.setInteractive({useHandCursor:!0}).on("pointerup",(()=>{if(0!==this.bgLayer.mapData[a][e]||-1!==this.buildingLayer.mapData[a][e])return;this.isPlacingMode=!1;const t=this.previewTank.data.tank;this.statusBar.data.money-=t.price,this.buildingLayer.mapData[a][e]=t.mapObjId;const i=this.buildingLayer.gridMap[a][e],n=this.add.image(i.x,i.y,t.imageKey).setOrigin(0);this.buildingLayer.gridMap[a][e]=n,this.buildingLayer.container.replace(i,n,!0)})),t.setSize(60),t.setStrokeStyle(4),t.setDisplayOrigin(-2,-2)}))})),this.placingLayer=a}updateMapPlacingLayer(){const{mapData:t}=this.bgLayer,{mapData:a}=this.buildingLayer,{gridMap:e,container:i}=this.placingLayer;e.forEach(((e,i)=>{e.forEach(((e,n)=>{const s=0===t[i][n]&&-1===a[i][n]?3135122:16723513;e.setStrokeStyle(4,s)}))})),i.setVisible(this.isPlacingMode)}createStatusBar(){this.statusBar={data:{stage:1,money:300,live:10},view:{containerEl:document.createElement("div"),bodyEl:document.createElement("div"),stageEl:document.createElement("div"),moneyEl:document.createElement("div"),liveEl:document.createElement("div")}},this.statusBar.view.containerEl.id="status-bar-container",this.statusBar.view.containerEl.style.width="100%",this.statusBar.view.containerEl.style.height="64px",this.statusBar.view.bodyEl.id="status-bar",this.statusBar.view.containerEl.appendChild(this.statusBar.view.bodyEl),this.statusBar.view.stageEl.innerText=`第 ${this.statusBar.data.stage} 關`,this.statusBar.view.bodyEl.appendChild(this.statusBar.view.stageEl),this.statusBar.view.moneyEl.innerText=`$: ${this.statusBar.data.money}`,this.statusBar.view.bodyEl.appendChild(this.statusBar.view.moneyEl),this.statusBar.view.liveEl.innerText=`❤: ${this.statusBar.data.live}`,this.statusBar.view.bodyEl.appendChild(this.statusBar.view.liveEl),this.add.dom(0,0,this.statusBar.view.containerEl).setOrigin(0)}updateStatusBar(){this.statusBar.view.stageEl.innerText=`第 ${this.statusBar.data.stage} 關`,this.statusBar.view.moneyEl.innerText=`$: ${this.statusBar.data.money}`,this.statusBar.view.liveEl.innerText=`❤: ${this.statusBar.data.live}`}createTankBar(){const t=[];for(let a=0;a<12;a++){const e=40+80*a,n=this.add.container(e,16,[this.add.rectangle(0,0,64,64,4342338).setOrigin(0),...a<i.length?[this.add.image(0,0,i[a].imageKey).setInteractive({useHandCursor:!0}).on("pointerup",(()=>{const t=i[a];t.price>this.statusBar.data.money||(this.isPlacingMode=!0,this.previewTank.data.tank=t)})).on("pointerover",(()=>{this.tankIntro.data.tank=i[a],this.tankIntro.data.visible=!0})).on("pointermove",(({x:t,y:a})=>{this.tankIntro.data.position={x:t,y:a}})).on("pointerout",(()=>{this.tankIntro.data.visible=!1})).setOrigin(0)]:[]]);t.push(n)}this.add.container(0,704,[this.add.rectangle(0,0,1024,96,5921370).setOrigin(0),...t]),this.createTankIntro()}updateTankBar(){this.updateTankIntro()}createTankIntro(){this.tankIntro={view:{containerEl:document.createElement("div"),bgEl:document.createElement("div"),contentEl:document.createElement("div"),body:null},data:{visible:!1,tank:null,position:{x:0,y:0}}},this.tankIntro.view.containerEl.id="tank-intro-container",this.tankIntro.view.bgEl.id="tank-intro-bg",this.tankIntro.view.containerEl.appendChild(this.tankIntro.view.bgEl),this.tankIntro.view.contentEl.id="tank-intro-content",this.tankIntro.view.bgEl.appendChild(this.tankIntro.view.contentEl),this.tankIntro.view.body=this.add.dom(0,0,this.tankIntro.view.containerEl).setOrigin(0,1)}updateTankIntro(){const t=this.tankIntro.data.tank,{x:a,y:e}=this.tankIntro.data.position;this.tankIntro.data.visible&&t&&(this.tankIntro.view.body.setX(a).setY(e),this.tankIntro.view.contentEl.innerHTML=`${t.name}<br>射擊速度<br>攻擊力<br>特殊功能?緩速<br>價錢: ${t.price}`),this.tankIntro.view.body.setVisible(this.tankIntro.data.visible)}createPreviewTank(){this.previewTank={view:{container:this.add.container(0,0),rangeCircle:this.add.ellipse(0,0,0,0,15568017,.3),image:this.add.image(0,0)},data:{position:{x:0,y:0},tank:null}},this.previewTank.view.container.add([this.previewTank.view.rangeCircle,this.previewTank.view.image]),this.input.on("pointermove",(({x:t,y:a})=>{this.previewTank.data.position={x:t,y:a}}))}updatePreviewTank(){null!==this.previewTank.data.tank?(this.previewTank.view.image.setTexture(this.previewTank.data.tank.imageKey),this.previewTank.view.rangeCircle.setSize(64*this.previewTank.data.tank.range*.45,64*this.previewTank.data.tank.range*.45).setOrigin(.5),this.previewTank.view.container.setPosition(this.previewTank.data.position.x,this.previewTank.data.position.y),this.previewTank.view.container.setVisible(this.isPlacingMode)):this.previewTank.view.container.setVisible(!1)}}!function(){const a={parent:"game",dom:{createContainer:!0},type:t.exports.AUTO,width:1024,height:800,physics:{default:"arcade",arcade:{debug:!1}}},i=new t.exports.Game(a);i.scene.add("welcomeScene",new e),i.scene.add("stageScene",new n),i.scene.start("welcomeScene")}();
